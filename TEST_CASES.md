# 基金/股票追踪器功能测试用例

## 测试环境
- Node.js 版本: >=18
- Supabase 项目已配置
- 数据库迁移已执行

## 前置条件
1. 运行数据库迁移：
```sql
alter table public.user_funds add column if not exists type varchar(10) default 'fund' check (type in ('fund', 'stock'));
alter table public.fund_transactions add column if not exists type varchar(10) default 'fund' check (type in ('fund', 'stock'));
create index if not exists idx_user_funds_user_type on public.user_funds(user_id, type);
create index if not exists idx_fund_transactions_user_type on public.fund_transactions(user_id, type);
```

2. 启动开发服务器：
```bash
cd fund-tracker
npm run dev
```

---

## 测试用例

### TC001: 搜索基金
**步骤:**
1. 在首页搜索框输入基金代码，如 `161039`
2. 查看搜索结果

**预期结果:**
- 显示搜索结果，带有"基金"标签（青色）
- 显示基金名称和代码

**验证方法:**
- [ ] 搜索结果显示类型标签为"基金"
- [ ] 点击结果后弹出添加弹窗

---

### TC002: 搜索股票
**步骤:**
1. 在首页搜索框输入股票代码，如 `000001`
2. 查看搜索结果

**预期结果:**
- 显示搜索结果，带有"股票"标签（橙色）
- 显示股票名称和代码

**验证方法:**
- [ ] 搜索结果显示类型标签为"股票"
- [ ] 点击结果后弹出添加弹窗

---

### TC003: 添加基金持仓
**步骤:**
1. 搜索基金并选择
2. 在弹窗中填写：
   - 持有份额: 1000
   - 成本单价: 1.5000
3. 点击"添加"

**预期结果:**
- 持仓列表显示新添加的基金
- 显示基金名称、类型标签、份额、成本价、市值、收益等信息

**验证方法:**
- [ ] 基金显示在持仓列表中
- [ ] 类型标签显示"基金"
- [ ] 显示正确的持有份额和成本价
- [ ] 当前净值正确显示

---

### TC004: 添加股票持仓
**步骤:**
1. 搜索股票并选择
2. 在弹窗中填写：
   - 持股数: 500
   - 成本价: 10.50
3. 点击"添加"

**预期结果:**
- 持仓列表显示新添加的股票
- 显示股票名称、类型标签、股数、成本价、市值、收益等信息

**验证方法:**
- [ ] 股票显示在持仓列表中
- [ ] 类型标签显示"股票"
- [ ] 显示正确的持股数和成本价
- [ ] 当前价格正确显示（不是净值）

---

### TC005: 基金加减仓（买入）
**步骤:**
1. 在持仓列表中找到基金
2. 点击"加减仓"按钮（+号图标）
3. 选择"买入"，填写：
   - 份额: 500
   - 单价: 1.6000
4. 点击"确认买入"

**预期结果:**
- 持仓列表更新
- 持有份额增加
- 平均成本更新

**验证方法:**
- [ ] 持有份额增加
- [ ] 平均成本重新计算
- [ ] 收益数据更新

---

### TC006: 基金加减仓（卖出）
**步骤:**
1. 在持仓列表中找到基金
2. 点击"加减仓"按钮
3. 选择"卖出"，填写：
   - 份额: 200
   - 单价: 1.8000
4. 点击"确认卖出"

**预期结果:**
- 持仓列表更新
- 持有份额减少
- 收益增加

**验证方法:**
- [ ] 持有份额减少
- [ ] 收益数据正确更新
- [ ] 卖出逻辑正确（FIFO）

---

### TC007: 股票加减仓
**步骤:**
1. 在持仓列表中找到股票
2. 点击"加减仓"按钮
3. 选择"买入"或"卖出"，填写股数和股价
4. 点击确认

**预期结果:**
- 持仓更新
- 持股数变化
- 成本价重新计算

**验证方法:**
- [ ] 持股数正确更新
- [ ] 成本价正确更新
- [ ] 市值正确计算

---

### TC008: 日内做T（同一股票）
**步骤:**
1. 在持仓列表中找到股票
2. 点击"加减仓"按钮
3. 买入: 100股，价格 10.00
4. 再次点击"加减仓"
5. 卖出: 100股，价格 10.50
6. 点击"交易记录"按钮查看

**预期结果:**
- 交易历史中显示日内做T记录
- 显示买入卖出配对
- 显示差价和收益

**验证方法:**
- [ ] 日内做T记录显示在历史中
- [ ] 差价计算正确（10.50 - 10.00 = 0.50）
- [ ] 收益计算正确（0.50 × 100 = 50）

---

### TC009: 查看交易记录
**步骤:**
1. 在持仓列表中找到任意持仓
2. 点击"交易记录"按钮（时钟图标）

**预期结果:**
- 弹出交易历史窗口
- 显示所有交易记录
- 按时间倒序排列

**验证方法:**
- [ ] 显示所有买入卖出记录
- [ ] 绿色边框显示买入，红色边框显示卖出
- [ ] 显示每日汇总

---

### TC010: 删除基金持仓
**步骤:**
1. 在持仓列表中找到基金
2. 点击"删除"按钮（垃圾桶图标）
3. 确认删除

**预期结果:**
- 持仓从列表中移除
- 相关交易记录同时删除

**验证方法:**
- [ ] 基金从列表移除
- [ ] 相关交易记录被清除
- [ ] 重新添加同一基金时，是新建的持仓（无历史交易）

---

### TC011: 删除股票持仓
**步骤:**
1. 在持仓列表中找到股票
2. 点击"删除"按钮
3. 确认删除

**预期结果:**
- 持仓从列表中移除
- 相关交易记录同时删除

**验证方法:**
- [ ] 股票从列表移除
- [ ] 相关交易记录被清除
- [ ] 重新添加同一股票时，是新建的持仓（无历史交易）

---

### TC012: 拖拽排序
**步骤:**
1. 在持仓列表中按住拖拽图标
2. 拖动到新位置
3. 释放

**预期结果:**
- 持仓顺序改变
- 刷新页面后顺序保持

**验证方法:**
- [ ] 持仓可以拖拽排序
- [ ] 刷新后顺序不变

---

### TC013: 重复添加同一基金（回归测试）
**步骤:**
1. 添加基金A，份额100，成本1.5
2. 删除基金A
3. 重新搜索并添加基金A，份额200，成本2.0
4. 查看交易记录

**预期结果:**
- 第二次添加是新的持仓
- 交易记录清空

**验证方法:**
- [ ] 第二次添加成功
- [ ] 交易记录从零开始（无之前的数据）
- [ ] 份额显示200，不是300（验证删除清理了数据）

---

### TC014: 重复添加同一股票（回归测试）
**步骤:**
1. 添加股票B，股数100，成本10
2. 做一次买入：+50股，成本10.5
3. 做一次卖出：-30股，价格11
4. 删除股票B
5. 重新搜索并添加股票B，股数80，成本12
6. 查看交易记录

**预期结果:**
- 第二次添加是新的持仓
- 交易记录清空

**验证方法:**
- [ ] 第二次添加成功
- [ ] 交易记录从零开始
- [ ] 份额显示80，不是120（验证删除清理了数据）

---

## 回归测试清单

| 功能模块 | 测试用例 | 状态 |
|---------|---------|------|
| 搜索 | TC001 搜索基金 | ☐ |
| 搜索 | TC002 搜索股票 | ☐ |
| 添加 | TC003 添加基金持仓 | ☐ |
| 添加 | TC004 添加股票持仓 | ☐ |
| 交易 | TC005 基金买入 | ☐ |
| 交易 | TC006 基金卖出 | ☐ |
| 交易 | TC007 股票加减仓 | ☐ |
| 做T | TC008 日内做T | ☐ |
| 查询 | TC009 查看交易记录 | ☐ |
| 删除 | TC010 删除基金 | ☐ |
| 删除 | TC011 删除股票 | ☐ |
| 排序 | TC012 拖拽排序 | ☐ |
| 回归 | TC013 重复添加基金 | ☐ |
| 回归 | TC014 重复添加股票 | ☐ |
| UI | TC015 基金卡片显示 | ☐ |
| UI | TC016 股票卡片显示 | ☐ |
| UI | TC017 响应式布局 | ☐ |
| UI | TC018 Tab 切换显示 | ☐ |

---

### TC015: 基金卡片显示
**步骤:**
1. 进入仪表盘页面
2. 查看基金板块

**预期结果:**
- 基金以卡片形式显示（网格布局）
- 桌面端每行 2-3 列
- 卡片显示：名称、持有份额，成本价、当前净值、市值、收益率
- 操作按钮（记录，加减仓、删除）始终可见

**验证方法:**
- [ ] 基金以卡片网格显示
- [ ] 响应式布局正常
- [ ] 所有数据正确显示
- [ ] 操作按钮始终可见

---

### TC016: 股票卡片显示
**步骤:**
1. 进入仪表盘页面
2. 查看股票板块

**预期结果:**
- 股票以卡片形式显示（网格布局）
- 显示：名称、持股数、买入均价、当前股价、日涨跌、日收益、持仓总额、总收益
- 操作按钮始终可见

**验证方法:**
- [ ] 股票以卡片网格显示
- [ ] 所有数据正确显示
- [ ] 操作按钮始终可见

---

### TC017: 响应式布局
**步骤:**
1. 在大屏幕上查看（≥1600px）
2. 在笔记本上查看（≥1280px）
3. 在平板上查看（≥768px）
4. 在手机上查看（<768px）

**预期结果:**
- 大屏幕：3 列
- 笔记本：2 列
- 平板：2 列
- 手机：1 列

**验证方法:**
- [ ] 大屏幕显示 3 列
- [ ] 笔记本显示 2 列
- [ ] 平板显示 2 列
- [ ] 手机显示 1 列

---

### TC018: Tab 切换显示
**步骤:**
1. 进入仪表盘页面
2. 点击"股票"Tab

**预期结果:**
- 基金模块隐藏
- 股票模块显示
- Tab 高亮切换到股票

**验证方法:**
- [ ] 点击Tab后内容切换
- [ ] 选中Tab颜色高亮
- [ ] 响应式布局正常

---

## 已知问题

### 已修复
- [x] 删除持仓时未同时删除交易记录
- [x] 搜索API过滤逻辑错误导致类型显示不正确
- [x] 基金名称过长时超出卡片边界（添加 overflow-hidden, min-w-0, truncate）

### 待确认
- [ ] 股票实时价格获取是否正常
- [ ] 日内做T自动识别是否准确

---

## 测试账号
请使用已注册的账号进行测试，或先注册新账号。

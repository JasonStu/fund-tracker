# 股票详情页设计与日涨跌修复方案

> **For Claude:** 使用 superpowers:writing-plans skill 执行实现计划

**Goal:** 修复日涨跌计算错误，并创建股票详情页

**Architecture:**
- 修复：直接使用 API 返回的 f169/f170 字段计算日涨跌
- 详情页：使用与基金详情页一致的 Tab 切换结构

**Tech Stack:** Next.js 16, React 19, Tailwind CSS 4, ECharts

---

## 问题1：日涨跌计算错误

### 原因
代码错误地使用了 f57 字段（股票代码 "002050"）来计算日涨跌：
```tsx
const f57 = parseFloat(data.data.f57) || 0; // 错误：这是股票代码！
const change = f43 - f57; // 53.48 - 2050 = -1996.52
```

### 修复
直接使用 API 返回的正确字段：
- f169 = 涨跌额
- f170 = 涨跌幅%

### 修改文件
- `src/app/api/user-funds/route.ts` (getStockRealtimePrice 函数)

---

## 问题2：股票详情页设计

### 布局结构
```
┌─────────────────────────────────────────────────────┐
│  股票名称                              [代码: 002050] │
│  当前价格: ¥53.48        涨跌: +0.81    涨幅: +1.54%  │
├─────────────────────────────────────────────────────┤
│  [持仓概览]  [走势图表]  [交易记录]                    │  ← Tab 切换
├─────────────────────────────────────────────────────┤
│  Tab 内容区域                                       │
└─────────────────────────────────────────────────────┘
```

### Tab 内容

**1. 持仓概览 (Overview)**
- 持仓数量、平均成本
- 当前市值、总盈亏、盈亏比例
- 持仓占比

**2. 走势图表 (Chart)**
- K线/分时图（使用 ECharts）
- 时间范围选择：1日、1周、1月、3月、1年

**3. 交易记录 (Transactions)**
- 买入/卖出历史
- 成本明细
- 每日汇总

### 视觉风格
- 与基金详情页保持一致
- 股票使用橙色主题 (#ff9500)
- 卡片式布局

### 新建文件
- `src/app/(dashboard)/stock/[code]/page.tsx`

### API 需求
- 股票行情 API：已存在 (`getStockRealtimePrice`)
- K线数据 API：需要创建 (`/api/stocks/kline`)

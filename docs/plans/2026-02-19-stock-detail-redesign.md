# 股票详情页重构设计文档

**日期**: 2026-02-19
**状态**: 已批准

---

## 1. 概述

对股票详情页进行重构，解决以下问题：
1. i18n 国际化未完成
2. K线图时间范围切换不符合常规股票软件习惯
3. 缺少常用技术指标和均线选择器
4. 缺少分时图功能

---

## 2. 整体架构

```
股票详情页
├── 头部卡片（股票名称、价格、涨跌幅）
├── Tab切换器（Overview / Chart / Transactions）
└── 图表区域（Chart Tab内）
    ├── 图表类型切换（分时 / 日K / 周K / 月K）
    ├── 均线选择器（支持自定义均线）
    ├── 主图区域
    └── 副图区域（3个，始终显示）
```

---

## 3. 功能设计

### 3.1 图表类型切换

将"时间范围筛选"改为标准股票软件模式：

| 类型 | 说明 |
|------|------|
| 分时 | 显示最近5日的分钟级走势叠加 |
| 日K | 每根K线代表1个交易日 |
| 周K | 每根K线代表1周 |
| 月K | 每根K线代表1月 |

### 3.2 均线选择器

支持预设均线和自定义均线：

**预设均线**：
- MA5、MA10、MA15、MA20、MA60

**自定义均线**：
- 用户输入周期数字（如 7、30、120）
- 添加到图表显示
- 可删除已添加的自定义均线

### 3.3 副图指标

**分时图模式**：
| 副图 | 内容 |
|------|------|
| 副图1 | MACD |
| 副图2 | 分时量能 + KDJ |
| 副图3 | 主力资金流入/流出 |

**K线图模式**：
| 副图 | 内容 |
|------|------|
| 副图1 | MACD（DIF/DEA/MACD柱） |
| 副图2 | 量能（VOL + MAVOL） |
| 副图3 | 可切换（主力资金/BBI/KDJ） |

---

## 4. 技术方案

### 4.1 技术指标库

使用 `technicalindicators` npm库计算指标：

```typescript
import { MACD, RSI, BBI, KDJ, SMA, EMA } from 'technicalindicators';
```

### 4.2 API 设计

**新增 API 端点**：

```
GET /api/stocks/kline
  - query: code, period (daily|weekly|monthly)
  - 返回: K线数据

GET /api/stocks/intraday
  - query: code, days (1|5)
  - 返回: 分时数据

GET /api/stocks/moneyflow
  - query: code
  - 返回: 主力资金流向数据
```

### 4.3 i18n 国际化

在 `messages/zh.json` 和 `messages/en.json` 中添加 `StockDetail` 命名空间。

---

## 5. 界面设计

### 5.1 顶部工具栏

```
[分时] [日K] [周K] [月K]    [MA5☐ MA10☐ MA15☐ MA20☐ MA60☐] [+自定义]
```

### 5.2 副图布局

```
┌─────────────────────────────────────────┐
│              主图区域                    │
│         (分时图 或 K线图)                │
├─────────────────────────────────────────┤
│              副图1: MACD                │
├─────────────────────────────────────────┤
│              副图2: 量能                 │
├─────────────────────────────────────────┤
│              副图3: 主力资金             │
└─────────────────────────────────────────┘
```

---

## 6. 验收标准

1. ✅ 股票详情页支持中英文切换
2. ✅ 图表支持分时/日K/周K/月K切换
3. ✅ 均线选择器支持预设和自定义均线
4. ✅ 分时图显示3个副图（MACD、量能、主力资金）
5. ✅ K线图显示3个副图（MACD、量能、可切换指标）
6. ✅ 技术指标使用 `technicalindicators` 库计算
